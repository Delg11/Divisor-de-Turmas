<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Divisor de Turmas Escolar</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        const Icons = {
            Users: () => (
                <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" />
                </svg>
            ),
                // Adicione os novos √≠cones aqui
            Linkedin: () => (
                <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z M2 9h4v12H2z M4 6a2 2 0 1 1 0-4 2 2 0 0 1 0 4z" />
                </svg>
            ),
            BookOpen: () => (
                <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253" />
                </svg>
            ),
            Github: () => (
                <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22" />
                </svg>
            ),
            UserX: () => (
                <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 7a4 4 0 11-8 0 4 4 0 018 0zM9 14a6 6 0 00-6 6v1h12v-1a6 6 0 00-6-6zM21 12h-6" />
                </svg>
            ),
            Heart: () => (
                <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                </svg>
            ),
            Shuffle: () => (
                <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
                </svg>
            ),
            Trash2: () => (
                <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
            ),
            CheckCircle: () => (
                <svg className="w-full h-full" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            )
        };

        function ClassDivider() {
            const [step, setStep] = useState(1);
            const [students, setStudents] = useState([]);
            const [studentListText, setStudentListText] = useState('');
            const [restrictions, setRestrictions] = useState([]);
            const [mustBeTogetherGroups, setMustBeTogetherGroups] = useState([]);
            const [preferences, setPreferences] = useState({});
            const [maxFriendsPerStudent, setMaxFriendsPerStudent] = useState(2);
            const [classes, setClasses] = useState(null);
            const [selectedStudents, setSelectedStudents] = useState([]);
            const [selectedTogetherStudents, setSelectedTogetherStudents] = useState([]);

            // üîß NOVO: n√∫mero de turmas configur√°vel
            const [numClasses, setNumClasses] = useState(3);

            const removeStudent = (name) => {
                setStudents(students.filter(s => s !== name));
                setRestrictions(restrictions.filter(r => !r.includes(name)));
                setMustBeTogetherGroups(mustBeTogetherGroups.filter(g => !g.includes(name)));
                const newPrefs = { ...preferences };
                delete newPrefs[name];
                Object.keys(newPrefs).forEach(key => {
                    newPrefs[key] = newPrefs[key].filter(p => p !== name);
                });
                setPreferences(newPrefs);
            };

            const addRestriction = () => {
                if (selectedStudents.length >= 2) {
                    const sorted = [...selectedStudents].sort();

                    const exists = restrictions.some(r =>
                        JSON.stringify([...r].sort()) === JSON.stringify(sorted)
                    );
                    if (exists) {
                        setSelectedStudents([]);
                        return;
                    }

                    // Nova lista simulando a restri√ß√£o adicionada
                    const newRestrictions = [...restrictions, sorted];

                    // Monta lista de pares √∫nicos (arestas)
                    const pairs = [];
                    newRestrictions.forEach(group => {
                        for (let i = 0; i < group.length; i++) {
                            for (let j = i + 1; j < group.length; j++) {
                                pairs.push([group[i], group[j]]);
                            }
                        }
                    });

                    // Cria um conjunto de todos os alunos envolvidos
                    const allStudents = [...new Set(pairs.flat())];

                    // Verifica se existe um subconjunto imposs√≠vel (clique completo)
                    let conflictGroup = null;
                    for (let size = numClasses + 1; size <= allStudents.length; size++) {
                        // Gera todas as combina√ß√µes poss√≠veis de alunos desse tamanho
                        const combos = combinations(allStudents, size);
                        for (const combo of combos) {
                            if (isCompleteConflict(combo, pairs)) {
                                conflictGroup = combo;
                                break;
                            }
                        }
                        if (conflictGroup) break;
                    }

                    if (conflictGroup) {
                        alert(`‚ö†Ô∏è Conflito detectado!
            Esses alunos (${conflictGroup.join(", ")}) possuem restri√ß√µes que exigiriam mais turmas (${conflictGroup.length}) do que as dispon√≠veis (${numClasses}).`);
                    } else {
                        setRestrictions(newRestrictions);
                    }

                    setSelectedStudents([]);
                }
            };

            // Fun√ß√£o auxiliar: todas as combina√ß√µes de um array
            function combinations(arr, k) {
                if (k === 0) return [[]];
                if (arr.length < k) return [];
                const [first, ...rest] = arr;
                const withFirst = combinations(rest, k - 1).map(c => [first, ...c]);
                const withoutFirst = combinations(rest, k);
                return [...withFirst, ...withoutFirst];
            }

            // Verifica se todos os pares em 'combo' est√£o presentes em 'pairs'
            function isCompleteConflict(combo, pairs) {
                for (let i = 0; i < combo.length; i++) {
                    for (let j = i + 1; j < combo.length; j++) {
                        const a = combo[i], b = combo[j];
                        const hasEdge = pairs.some(([x, y]) =>
                            (x === a && y === b) || (x === b && y === a)
                        );
                        if (!hasEdge) return false;
                    }
                }
                return true;
            }



            const addMustBeTogether = () => {
                if (selectedTogetherStudents.length >= 2) {
                    const sorted = [...selectedTogetherStudents].sort();
                    const exists = mustBeTogetherGroups.some(g =>
                        JSON.stringify([...g].sort()) === JSON.stringify(sorted)
                    );
                    if (!exists) {
                        setMustBeTogetherGroups([...mustBeTogetherGroups, selectedTogetherStudents]);
                    }
                    setSelectedTogetherStudents([]);
                }
            };

            const removeRestriction = (index) => setRestrictions(restrictions.filter((_, i) => i !== index));
            const removeMustBeTogether = (index) => setMustBeTogetherGroups(mustBeTogetherGroups.filter((_, i) => i !== index));

            // üîß MODIFICADO: respeita o limite igual ao n√∫mero de turmas
            const toggleStudent = (name) => {
                if (selectedStudents.includes(name)) {
                    setSelectedStudents(selectedStudents.filter(s => s !== name));
                } else if (selectedStudents.length < numClasses) {
                    setSelectedStudents([...selectedStudents, name]);
                } else {
                    alert(`Voc√™ s√≥ pode selecionar at√© ${numClasses} alunos para restri√ß√£o, pois h√° apenas ${numClasses} turmas.`);
                }
            };

            const toggleTogetherStudent = (name) => {
                if (selectedTogetherStudents.includes(name)) {
                    setSelectedTogetherStudents(selectedTogetherStudents.filter(s => s !== name));
                } else {
                    setSelectedTogetherStudents([...selectedTogetherStudents, name]);
                }
            };

            const addPreference = (student, friend) => {
                if (!friend || friend === student) return;
                const current = preferences[student] || [];
                if (!current.includes(friend) && current.length < maxFriendsPerStudent) {
                    setPreferences({
                        ...preferences,
                        [student]: [...current, friend]
                    });
                }
            };

            const removePreference = (student, friend) => {
                setPreferences({
                    ...preferences,
                    [student]: (preferences[student] || []).filter(f => f !== friend)
                });
            };

            const divideClasses = () => {
                // inicializa turmas vazias
                const result = Array(numClasses).fill(null).map(() => []);
                const assigned = new Set();
                const warnings = [];

                // constr√≥i mapa "n√£o pode com"
                const cannotWith = {};
                students.forEach(s => cannotWith[s] = new Set());
                restrictions.forEach(group => {
                    for (let i = 0; i < group.length; i++) {
                        for (let j = i + 1; j < group.length; j++) {
                            cannotWith[group[i]].add(group[j]);
                            cannotWith[group[j]].add(group[i]);
                        }
                    }
                });

                // mapeia grupos que DEVEM ficar juntos
                // (cada aluno aponta para o grupo completo)
                const mustTogetherMap = {};
                mustBeTogetherGroups.forEach(group => {
                    group.forEach(s => mustTogetherMap[s] = group.slice());
                });

                // util: testa se um aluno pode entrar numa turma (comparando com todos j√° l√°)
                const canAssignStudentToClass = (student, classIndex) => {
                    const turma = result[classIndex];
                    for (const other of turma) {
                        if (cannotWith[student] && cannotWith[student].has(other)) return false;
                    }
                    return true;
                };

                // util: testa se um grupo todo pode entrar numa turma
                const canAssignGroupToClass = (groupArr, classIndex) => {
                    const turma = result[classIndex];
                    // grupo x turma: nenhum par (grupo member, turma member) pode ser proibido
                    for (const g of groupArr) {
                        for (const t of turma) {
                            if (cannotWith[g] && cannotWith[g].has(t)) return false;
                        }
                    }
                    // tamb√©m testa conflitos internos do pr√≥prio grupo (se houver restri√ß√£o interna, j√° deveria estar representada em restrictions)
                    // aqui assumimos que group √© "must together" sem conflitos internos
                    return true;
                };

                // calcula "peso" de um aluno (quanto mais restri√ß√µes, mais prioridade)
                const complexityScore = (s) => {
                    const cannot = cannotWith[s] ? cannotWith[s].size : 0;
                    const mustGroup = mustTogetherMap[s] ? mustTogetherMap[s].length - 1 : 0;
                    return cannot + mustGroup * 2; // pondera grupos um pouco mais
                };

                // lista de alunos ordenada por prioridade (mais complexo primeiro)
                const studentsSorted = [...students].sort((a, b) => complexityScore(b) - complexityScore(a));

                // 1) Alocar alunos "problem√°ticos" (aqueles com restri√ß√µes ou em mustTogetherGroups)
                for (const s of studentsSorted) {
                    if (assigned.has(s)) continue;

                    const group = mustTogetherMap[s] ? Array.from(new Set(mustTogetherMap[s])) : [s];
                    const unassignedGroup = group.filter(x => !assigned.has(x));

                    // se grupo vazio (j√° alocados), pula
                    if (unassignedGroup.length === 0) continue;

                    // ordena √≠ndices das turmas por tamanho crescente (para balancear ao colocar problem√°ticos)
                    const classIndicesBySize = result
                        .map((c, i) => ({ i, size: c.length }))
                        .sort((a, b) => a.size - b.size)
                        .map(x => x.i);

                    let placed = false;
                    for (const idx of classIndicesBySize) {
                        // se o grupo cabe (sem conflitos) nessa turma
                        if (canAssignGroupToClass(unassignedGroup, idx)) {
                            result[idx].push(...unassignedGroup);
                            unassignedGroup.forEach(x => assigned.add(x));
                            placed = true;
                            break;
                        }
                    }

                    if (!placed) {
                        // tenta fallback: tentar colocar membros do grupo separadamente (se grupo for s√≥ 1 isso √© redundante)
                        // aqui tentamos alocar cada membro do grupo individualmente em turmas menos cheias poss√≠veis
                        let allPlaced = true;
                        for (const mem of unassignedGroup) {
                            const bySize = result
                                .map((c, i) => ({ i, size: c.length }))
                                .sort((a, b) => a.size - b.size)
                                .map(x => x.i);
                            let placedMem = false;
                            for (const idx of bySize) {
                                if (canAssignStudentToClass(mem, idx)) {
                                    result[idx].push(mem);
                                    assigned.add(mem);
                                    placedMem = true;
                                    break;
                                }
                            }
                            if (!placedMem) {
                                allPlaced = false;
                                break;
                            }
                        }
                        if (!allPlaced) {
                            warnings.push(`N√£o foi poss√≠vel alocar o grupo/Aluno: ${group.join(", ")} sem violar restri√ß√µes.`);
                            // marca como n√£o alocado (n√£o adiciona a assigned) ‚Äî ser√£o tratados na pr√≥xima fase e/ou reportados
                        }
                    }
                }

                // 2) Agora alocar restantes (aqueles sem restri√ß√µes complexas) tentando balancear estritamente:
                const remaining = students.filter(s => !assigned.has(s));

                for (const s of remaining) {
                    // sempre pega a turma atualmente menos populosa onde caiba
                    const classIndicesBySize = result
                        .map((c, i) => ({ i, size: c.length }))
                        .sort((a, b) => a.size - b.size)
                        .map(x => x.i);

                    let placed = false;
                    for (const idx of classIndicesBySize) {
                        if (canAssignStudentToClass(s, idx)) {
                            result[idx].push(s);
                            assigned.add(s);
                            placed = true;
                            break;
                        }
                    }
                    if (!placed) {
                        warnings.push(`N√£o foi poss√≠vel alocar o aluno ${s} sem violar restri√ß√µes.`);
                    }
                }

                // 3) Resultado final e aviso se houver problemas
                setClasses(result);
                if (warnings.length > 0) {
                    alert(warnings.join("\n"));
                }
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
                    <div className="max-w-6xl mx-auto">
                        <div className="bg-white rounded-xl shadow-2xl p-8 mb-6">
                        <h1 className="text-4xl font-bold text-indigo-900 mb-2 flex items-center gap-3 relative">
                          <div className="w-10 h-10"><Icons.Users /></div>
                          Divisor de Turmas

                          {/* Bloco do "Criado por Gabriel Delgado" */}
                          <div className="relative group ml-4 text-indigo-900 text-sm font-semibold cursor-pointer select-none self-end">
                            Criado por Gabriel Delgado

                            {/* Menu flutuante vis√≠vel ao hover */}
                            <div className="absolute opacity-0 scale-95 group-hover:opacity-100 group-hover:scale-100 transition-all duration-200 ease-out flex flex-col gap-2 top-full left-0 mt-2 bg-indigo-50 border border-indigo-200 rounded-xl shadow-xl p-3 w-52 z-10">
                              <a
                                href="https://www.linkedin.com/in/gabriel-delgado-57134b53/"
                                target="_blank"
                                rel="noopener noreferrer"
                                className="text-sm text-indigo-800 hover:text-indigo-900 flex items-center gap-2 transition-colors"
                              >
                                <div className="w-4 h-4"><Icons.Linkedin /></div> LinkedIn
                              </a>
                              <a
                                href="http://lattes.cnpq.br/2608135584095323"
                                target="_blank"
                                rel="noopener noreferrer"
                                className="text-sm text-indigo-800 hover:text-indigo-900 flex items-center gap-2 transition-colors"
                              >
                                <div className="w-4 h-4"><Icons.BookOpen /></div> Lattes
                              </a>
                              <a
                                href="https://github.com/Delg11"
                                target="_blank"
                                rel="noopener noreferrer"
                                className="text-sm text-indigo-800 hover:text-indigo-900 flex items-center gap-2 transition-colors"
                              >
                                <div className="w-4 h-4"><Icons.Github /></div> GitHub
                              </a>
                            </div>
                          </div>
                        </h1>
                            <p className="text-gray-600 mb-6">Sistema de organiza√ß√£o de turmas escolares</p>

                            {/* üîß NOVO: seletor de n√∫mero de turmas */}
                            <div className="bg-indigo-50 border-l-4 border-indigo-500 p-4 rounded mb-6">
                                <label className="block text-sm font-semibold text-indigo-900 mb-2">
                                    Quantas turmas voc√™ deseja criar?
                                </label>
                                <select
                                    value={numClasses}
                                    onChange={(e) => setNumClasses(parseInt(e.target.value))}
                                    className="px-4 py-2 border border-indigo-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                >
                                    {[2, 3, 4, 5].map(n => (
                                        <option key={n} value={n}>{n} turma{n > 1 ? 's' : ''}</option>
                                    ))}
                                </select>
                                <p className="text-xs text-indigo-700 mt-1">
                                    M√°ximo de alunos por restri√ß√£o: {numClasses}
                                </p>
                            </div>

                      <div className="flex gap-2 mb-8 overflow-x-auto">
                                {[
                                    { num: 1, label: 'Alunos', Icon: Icons.Users },
                                    { num: 2, label: 'Restri√ß√µes', Icon: Icons.UserX },
                                    { num: 3, label: 'Prefer√™ncias', Icon: Icons.Heart },
                                    { num: 4, label: 'Resultado', Icon: Icons.Shuffle }
                                ].map(({ num, label, Icon }) => (
                                    <button
                                        key={num}
                                        onClick={() => setStep(num)}
                                        className={`flex items-center gap-2 px-4 py-2 rounded-lg transition-all ${
                                            step === num
                                                ? 'bg-indigo-600 text-white shadow-lg'
                                                : 'bg-gray-100 text-gray-600 hover:bg-gray-200'
                                        }`}
                                    >
                                        <div className="w-5 h-5"><Icon /></div>
                                        <span className="whitespace-nowrap">{label}</span>
                                    </button>
                                ))}
                            </div>

                            {step === 1 && (
                                <div>
                                    <h2 className="text-2xl font-bold text-gray-800 mb-4">1. Cadastro de Alunos</h2>
                                    
                                    <div className="bg-blue-50 border-l-4 border-blue-500 p-4 rounded mb-4">
                                        <p className="text-sm text-blue-800">
                                            <strong>Dica:</strong> Cole uma lista de nomes (um por linha) na √°rea abaixo para adicionar v√°rios alunos de uma vez!
                                        </p>
                                    </div>

                                    <div className="mb-4">
                                        <textarea
                                            value={studentListText}
                                            onChange={(e) => setStudentListText(e.target.value)}
                                            placeholder="Cole aqui a lista de alunos (um nome por linha)

Exemplo:
S√¥nia Fernandes
S√¥nia Gon√ßalves
Bruna de Oliveira
Eduardo de Oliveira
Gabriela Araujo"
                                            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent min-h-[200px] font-mono text-sm"
                                        />
                                        <div className="flex gap-2 mt-2">
                                            <button
                                                onClick={() => {
                                                    const names = studentListText
                                                        .split('\n')
                                                        .map(name => name.trim())
                                                        .filter(name => name.length > 0);
                                                    
                                                    const newStudents = [...students];
                                                    names.forEach(name => {
                                                        if (!newStudents.includes(name)) {
                                                            newStudents.push(name);
                                                        }
                                                    });
                                                    setStudents(newStudents);
                                                    setStudentListText('');
                                                }}
                                                className="flex-1 px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-semibold"
                                            >
                                                Adicionar Lista de Alunos
                                            </button>
                                            <button
                                                onClick={() => setStudentListText('')}
                                                className="px-6 py-3 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors"
                                            >
                                                Limpar
                                            </button>
                                        </div>
                                    </div>

                                    <div className="bg-gray-50 rounded-lg p-4">
                                        <h3 className="font-semibold text-gray-700 mb-3">Alunos cadastrados: {students.length}</h3>
                                        <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2">
                                            {students.map(student => (
                                                <div key={student} className="flex items-center justify-between bg-white px-3 py-2 rounded shadow-sm">
                                                    <span className="text-sm truncate">{student}</span>
                                                    <button
                                                        onClick={() => removeStudent(student)}
                                                        className="text-red-500 hover:text-red-700 flex-shrink-0 ml-2"
                                                        title="Remover aluno"
                                                    >
                                                        <div className="w-3.5 h-3.5"><Icons.Trash2 /></div>
                                                    </button>
                                                </div>
                                            ))}
                                        </div>
                                    </div>

                                    {students.length >= 6 && (
                                        <button
                                            onClick={() => setStep(2)}
                                            className="mt-6 w-full py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-semibold"
                                        >
                                            Pr√≥xima Etapa: Restri√ß√µes ‚Üí
                                        </button>
                                    )}
                                </div>
                            )}

                            {step === 2 && (
                                <div>
                                    <h2 className="text-2xl font-bold text-gray-800 mb-4">2. Restri√ß√µes dos Professores</h2>
                                    
                                    <div className="mb-6">
                                        <h3 className="text-lg font-semibold text-red-700 mb-2">‚ùå Alunos que N√ÉO podem ficar na mesma turma</h3>
                                        <p className="text-gray-600 mb-4">Selecione alunos que devem ser separados:</p>

                                        <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 mb-4">
                                            {students.map(student => (
                                                <button
                                                    key={student}
                                                    onClick={() => toggleStudent(student)}
                                                    className={`px-4 py-2 rounded-lg transition-all ${
                                                        selectedStudents.includes(student)
                                                            ? 'bg-red-500 text-white shadow-lg'
                                                            : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                                    }`}
                                                >
                                                    {student}
                                                </button>
                                            ))}
                                        </div>

                                        {selectedStudents.length >= 2 && (
                                            <button
                                                onClick={addRestriction}
                                                className="w-full py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors mb-4 font-semibold"
                                            >
                                                ‚ùå Adicionar Restri√ß√£o ({selectedStudents.length} alunos N√ÉO podem ficar juntos)
                                            </button>
                                        )}

                                        <div className="bg-red-50 rounded-lg p-4">
                                            <h4 className="font-semibold text-gray-700 mb-3">Restri√ß√µes definidas:</h4>
                                            {restrictions.length === 0 ? (
                                                <p className="text-gray-500 text-sm">Nenhuma restri√ß√£o adicionada</p>
                                            ) : (
                                                <div className="space-y-2">
                                                    {restrictions.map((r, i) => (
                                                        <div key={i} className="flex items-center justify-between bg-white px-4 py-2 rounded shadow-sm">
                                                            <span className="text-sm flex items-center">
                                                                <div className="w-3.5 h-3.5 inline-block mr-2 text-red-500"><Icons.UserX /></div>
                                                                {r.join(' ‚Ä¢ ')}
                                                            </span>
                                                            <button
                                                                onClick={() => removeRestriction(i)}
                                                                className="text-red-500 hover:text-red-700 flex-shrink-0"
                                                            >
                                                                <div className="w-3.5 h-3.5"><Icons.Trash2 /></div>
                                                            </button>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    </div>

                                    <div className="mb-6">
                                        <h3 className="text-lg font-semibold text-green-700 mb-2">‚úÖ Alunos que DEVEM ficar na mesma turma</h3>
                                        <p className="text-gray-600 mb-4">Selecione alunos que s√£o boas influ√™ncias e devem permanecer juntos:</p>

                                        <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-2 mb-4">
                                            {students.map(student => (
                                                <button
                                                    key={student}
                                                    onClick={() => toggleTogetherStudent(student)}
                                                    className={`px-4 py-2 rounded-lg transition-all ${
                                                        selectedTogetherStudents.includes(student)
                                                            ? 'bg-green-500 text-white shadow-lg'
                                                            : 'bg-gray-100 text-gray-700 hover:bg-gray-200'
                                                    }`}
                                                >
                                                    {student}
                                                </button>
                                            ))}
                                        </div>

                                        {selectedTogetherStudents.length >= 2 && (
                                            <button
                                                onClick={addMustBeTogether}
                                                className="w-full py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors mb-4 font-semibold"
                                            >
                                                ‚úÖ Adicionar Grupo ({selectedTogetherStudents.length} alunos DEVEM ficar juntos)
                                            </button>
                                        )}

                                        <div className="bg-green-50 rounded-lg p-4">
                                            <h4 className="font-semibold text-gray-700 mb-3">Grupos que devem ficar juntos:</h4>
                                            {mustBeTogetherGroups.length === 0 ? (
                                                <p className="text-gray-500 text-sm">Nenhum grupo adicionado</p>
                                            ) : (
                                                <div className="space-y-2">
                                                    {mustBeTogetherGroups.map((g, i) => (
                                                        <div key={i} className="flex items-center justify-between bg-white px-4 py-2 rounded shadow-sm">
                                                            <span className="text-sm flex items-center">
                                                                <div className="w-3.5 h-3.5 inline-block mr-2 text-green-500"><Icons.Heart /></div>
                                                                {g.join(' ‚Ä¢ ')}
                                                            </span>
                                                            <button
                                                                onClick={() => removeMustBeTogether(i)}
                                                                className="text-red-500 hover:text-red-700 flex-shrink-0"
                                                            >
                                                                <div className="w-3.5 h-3.5"><Icons.Trash2 /></div>
                                                            </button>
                                                        </div>
                                                    ))}
                                                </div>
                                            )}
                                        </div>
                                    </div>

                                    <button
                                        onClick={() => setStep(3)}
                                        className="mt-6 w-full py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-semibold"
                                    >
                                        Pr√≥xima Etapa: Prefer√™ncias ‚Üí
                                    </button>
                                </div>
                            )}

                            {step === 3 && (
                                <div>
                                    <h2 className="text-2xl font-bold text-gray-800 mb-4">3. Prefer√™ncias dos Alunos</h2>
                                    
                                    <div className="bg-indigo-50 border-l-4 border-indigo-500 p-4 rounded mb-4">
                                        <label className="block text-sm font-semibold text-indigo-900 mb-2">
                                            Quantos amigos cada aluno pode escolher?
                                        </label>
                                        <input
                                            type="number"
                                            min="1"
                                            max="5"
                                            value={maxFriendsPerStudent}
                                            onChange={(e) => setMaxFriendsPerStudent(parseInt(e.target.value) || 2)}
                                            className="w-32 px-3 py-2 border border-indigo-300 rounded-lg focus:ring-2 focus:ring-indigo-500"
                                        />
                                        <p className="text-xs text-indigo-700 mt-1">
                                            Atualmente: at√© {maxFriendsPerStudent} amigo{maxFriendsPerStudent > 1 ? 's' : ''} por aluno
                                        </p>
                                    </div>

                                    <div className="space-y-4">
                                        {students.map(student => (
                                            <div key={student} className="bg-gray-50 rounded-lg p-4">
                                                <h3 className="font-semibold text-gray-700 mb-2">{student}</h3>
                                                <div className="flex gap-2">
                                                    <select
                                                        onChange={(e) => {
                                                            if (e.target.value) {
                                                                addPreference(student, e.target.value);
                                                                e.target.value = '';
                                                            }
                                                        }}
                                                        className="flex-1 px-3 py-2 border border-gray-300 rounded-lg text-sm"
                                                        disabled={(preferences[student] || []).length >= maxFriendsPerStudent}
                                                    >
                                                        <option value="">Selecionar amigo...</option>
                                                        {students
                                                            .filter(s => s !== student && !(preferences[student] || []).includes(s))
                                                            .map(s => (
                                                                <option key={s} value={s}>{s}</option>
                                                            ))}
                                                    </select>
                                                </div>
                                                {(preferences[student] || []).length > 0 && (
                                                    <div className="mt-2 flex gap-2 flex-wrap">
                                                        {preferences[student].map(friend => (
                                                            <div key={friend} className="flex items-center gap-1 bg-green-100 text-green-700 px-3 py-1 rounded-full text-sm">
                                                                <div className="w-3 h-3 flex-shrink-0"><Icons.Heart /></div>
                                                                <span>{friend}</span>
                                                                <button
                                                                    onClick={() => removePreference(student, friend)}
                                                                    className="ml-1 text-green-700 hover:text-green-900 font-bold"
                                                                >
                                                                    √ó
                                                                </button>
                                                            </div>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>

                                    <button
                                        onClick={() => {
                                            divideClasses();
                                            setStep(4);
                                        }}
                                        className="mt-6 w-full py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-semibold"
                                    >
                                        Gerar Turmas ‚Üí
                                    </button>
                                </div>
                            )}

                            {step === 4 && classes && (
                                <div>
                                    <h2 className="text-2xl font-bold text-gray-800 mb-4">4. Turmas Geradas</h2>
                                    
                                    <div className="grid md:grid-cols-3 gap-4 mb-6">
                                        {classes.map((classStudents, i) => (
                                            <div key={i} className="bg-gradient-to-br from-indigo-50 to-purple-50 rounded-lg p-4 border-2 border-indigo-200">
                                                <h3 className="text-xl font-bold text-indigo-900 mb-3">
                                                    Turma {i + 1}
                                                    <span className="text-sm font-normal text-gray-600 ml-2">
                                                        ({classStudents.length} alunos)
                                                    </span>
                                                </h3>
                                                                                                    <div className="space-y-1">
                                                    {classStudents.map(student => {
                                                        const hasPreference = preferences[student]?.some(friend => 
                                                            classStudents.includes(friend)
                                                        );
                                                        return (
                                                            <div
                                                                key={student}
                                                                className={`px-3 py-2 rounded flex items-center justify-between ${
                                                                    hasPreference
                                                                        ? 'bg-green-100 text-green-800'
                                                                        : 'bg-white text-gray-700'
                                                                }`}
                                                            >
                                                                <span className="flex-1">{student}</span>
                                                                {hasPreference && <div className="w-3.5 h-3.5 flex-shrink-0 ml-2"><Icons.Heart /></div>}
                                                            </div>
                                                        );
                                                    })}
                                                </div>

                                            </div>
                                        ))}
                                    </div>

                                    <div className="bg-blue-50 border-l-4 border-blue-500 p-4 rounded">
                                        <div className="flex items-start gap-2">
                                            <div className="w-5 h-5 text-blue-500 mt-0.5 flex-shrink-0"><Icons.CheckCircle /></div>
                                            <div>
                                                <p className="font-semibold text-blue-900">Divis√£o conclu√≠da!</p>
                                                <p className="text-sm text-blue-700">
                                                    Todas as restri√ß√µes dos professores foram respeitadas e as prefer√™ncias dos alunos foram atendidas sempre que poss√≠vel.
                                                </p>
                                            </div>
                                        </div>
                                    </div>

                                    <button
                                        onClick={() => {
                                            setClasses(null);
                                            setStep(1);
                                        }}
                                        className="mt-6 w-full py-3 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-semibold"
                                    >
                                        Nova Divis√£o
                                    </button>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<ClassDivider />, document.getElementById('root'));
    </script>
</body>
</html>
